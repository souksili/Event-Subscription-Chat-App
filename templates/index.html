{% extends 'layout.html' %}

{% block title %}Accueil{% endblock %}

{% block content %}

<h2>S'inscrire à un événement</h2>
<form id="subscribe-form">
    <div class="form-group">
        <label for="email">Adresse e-mail</label>
        <input type="email" class="form-control" id="email" required>
    </div>
    <div class="form-group">
        <label for="event_id">Sélectionnez un événement</label>
        <select class="form-control" id="event_id" required>
            {% for event in events %}
                <option value="{{ event.id }}">{{ event.title }}</option>
            {% endfor %}
        </select>
    </div>
    <button type="submit" class="btn btn-success">S'inscrire</button>
</form>

<script>
document.getElementById('subscribe-form').onsubmit = function(event) {
    event.preventDefault();
    const email = document.getElementById('email').value;
    const event_id = document.getElementById('event_id').value;

    fetch('/subscribe', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ email: email, event_id: event_id })
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message || data.error);
        if (data.message) {
            document.getElementById('subscribe-form').reset();
        }
    })
    .catch(error => console.error('Error:', error));
};
</script>
{% endblock %}